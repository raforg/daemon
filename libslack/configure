#!/bin/sh
#
# libslack - http://libslack.org/
#
# Copyright (C) 1999-2002, 2004, 2010, 2020-2023 raf <raf@raf.org>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <https://www.gnu.org/licenses/>.
#

# 20230313 raf <raf@raf.org>

die() { echo "$0: $@" >&2; exit 1; }

case "`uname -a`" in
	Linux*)
		echo "Configuring for linux"
		conf/linux
		;;

	GNU/kFreeBSD*)
		echo "Configuring for kfreebsd"
		conf/kfreebsd
		;;

	GNU*)
		echo "Configuring for GNU/Hurd"
		conf/gnuhurd
		;;

	FreeBSD*)
		echo "Configuring for freebsd"
		conf/freebsd
		;;

	NetBSD*)
		echo "Configuring for netbsd"
		conf/netbsd
		;;

	OpenBSD*)
		echo "Configuring for openbsd"
		conf/openbsd
		;;

	SunOS*)
		cc=""
		solaris="solaris10"
		[ "x`uname -r`" = "x5.8" ] && solaris="solaris8"
		[ "x`uname -r`" = "x5.6" ] && solaris="solaris6"
		if [ "`uname -m`" = sun4u ]
		then
			[ "x`which gcc 2>&-`" != "x" ] && cc="gcc"
			[ "x`which cc 2>&-`"  != "x" ] && cc="cc"
		else
			[ "x`which cc 2>&-`"  != "x" ] && cc="cc"
			[ "x`which gcc 2>&-`" != "x" ] && cc="gcc"
		fi
		[ "$cc" = "" ] && die "Failed to find a compiler"
		echo "Configuring for $solaris (with $cc)"
		conf/$solaris-$cc
		;;

	Darwin*)
		echo "Configuring for macosx"
		conf/macosx
		;;

	*)
		die "Unknown platform: please configure manually"
		;;
esac

# Set CC from $CC (for macports)

if [ "x$CC" != x ]
then
	echo "Configuring CC as $CC"
	conf/ccenv
fi

# Process command line options

for opt in "$@"
do
	case "$opt" in
		--prefix=*)
			echo "Configuring $opt"
			conf/prefix "$opt"
			;;
		--enable-test)
			echo "Configuring to include backup function implementations."
			conf/test
			;;
		--enable-test-rwlock)
			echo "Configuring to include backup rwlock implementation."
			conf/test-rwlock-start
			;;
		--disable-test-rwlock)
			echo "Configuring to exclude backup rwlock implementation (default)."
			conf/test-rwlock-stop
			;;
		*)
			echo "$0: Unknown argument: $@" >&2
			exit 1
			;;
	esac
done

# Prepare for parallel make

if [ x"`which gmake`" != x"" ]
then
	gmake ready
else
	make ready
fi

exit 0

# vi:set ts=4 sw=4:
